2025-09-04 09:52:24 [Info] Starting Microsoft 365 External User Audit...
2025-09-04 09:52:24 [Info] Output Path: .\AuditReports
2025-09-04 09:52:24 [Info] Step 1/7: Authenticating to Microsoft 365...
2025-09-04 09:52:24 [Info] üîê Initiating Microsoft 365 authentication sequence...
2025-09-04 09:52:24 [Info] Connecting to Microsoft Graph...
2025-09-04 09:54:26 [Success] ‚úÖ Connected to Microsoft Graph as: 
2025-09-04 09:54:26 [Info] Connecting to SharePoint Online...
2025-09-04 09:54:26 [Info] Using SharePoint Admin URL: https://m365x22747677-admin.sharepoint.com
2025-09-04 09:55:14 [Success] ‚úÖ Connected to SharePoint Online: https://m365x22747677-admin.sharepoint.com
2025-09-04 09:55:14 [Info] Connecting to Exchange Online...
2025-09-04 09:55:14 [Warning] Warning: Could not connect to Exchange Online. Continuing with limited functionality...
2025-09-04 09:55:14 [Warning] Exchange Online error: Unable to load DLL 'msalruntime' or one of its dependencies: The specified module could not be found. (0x8007007E) See https://aka.ms/msal-net-wam#troubleshooting
2025-09-04 09:55:14 [Success] ‚úÖ All services connected successfully
2025-09-04 09:55:14 [Info] Step 2/7: Discovering external users...
2025-09-04 09:55:14 [Info] üîç Discovering external users in tenant...
2025-09-04 09:55:14 [Info] Found 0 guest users in Azure AD
2025-09-04 09:55:16 [Success] Total external users discovered: 1
2025-09-04 09:55:16 [Info] Step 3/7: Analyzing SharePoint site access...
2025-09-04 09:55:16 [Info] üìÇ Analyzing SharePoint site access...
2025-09-04 09:55:42 [Warning] Error processing site: https://m365x22747677.sharepoint.com/sites/SalesPlanning
2025-09-04 09:55:44 [Success] ‚úÖ SharePoint site analysis complete
2025-09-04 09:55:44 [Info] Step 4/7: Analyzing Microsoft Teams access...
2025-09-04 09:55:44 [Info] üë• Analyzing Microsoft Teams access...
2025-09-04 09:55:44 [Success] ‚úÖ Teams analysis complete
2025-09-04 09:55:44 [Info] Step 5/7: Analyzing Microsoft 365 Group memberships...
2025-09-04 09:55:44 [Info] üìä Analyzing Microsoft 365 Group memberships...
2025-09-04 09:55:44 [Success] ‚úÖ Microsoft 365 Groups analysis complete
2025-09-04 09:55:44 [Info] Step 6/7: Analyzing site sharing settings...
2025-09-04 09:55:44 [Info] üîó Analyzing site sharing settings...
2025-09-04 09:55:46 [Success] ‚úÖ Site sharing settings analysis complete
2025-09-04 09:55:46 [Info] Step 7/7: Analyzing guest expiration...
2025-09-04 09:55:46 [Info] ‚è∞ Analyzing guest expiration settings...
2025-09-04 09:55:46 [Success] ‚úÖ Guest expiration analysis complete
2025-09-04 09:55:46 [Info] üìÑ Generating audit reports...
2025-09-04 09:55:46 [Success] ‚úÖ Main report exported: .\AuditReports\ExternalUserAudit_Main_20250904_095546.csv
2025-09-04 09:55:46 [Success] ‚úÖ Sharing settings report exported: .\AuditReports\SiteSharingSettings_20250904_095546.csv
2025-09-04 09:55:46 [Success] ‚úÖ Guest expiration report exported: .\AuditReports\GuestExpiration_20250904_095546.csv
2025-09-04 09:55:46 [Success] ‚úÖ Executive summary generated: .\AuditReports\ExecutiveSummary_20250904_095546.md
2025-09-04 09:55:46 [Success] ‚úÖ All reports generated successfully
2025-09-04 09:55:46 [Info] Disconnecting from Microsoft 365 services...
2025-09-04 10:28:49 [Info] Starting Microsoft 365 External User Audit...
2025-09-04 10:28:49 [Info] Output Path: .\AuditReports
2025-09-04 10:28:49 [Info] Step 1/7: Authenticating to Microsoft 365...
2025-09-04 10:28:49 [Info] üîê Initiating Microsoft 365 authentication sequence...
2025-09-04 10:28:49 [Info] Connecting to Microsoft Graph...
2025-09-04 10:30:53 [Success] ‚úÖ Connected to Microsoft Graph as: admin@M365x22747677.onmicrosoft.com
2025-09-04 10:30:53 [Info] Connecting to SharePoint Online...
2025-09-04 10:30:58 [Info] Using SharePoint Admin URL: https://m365x22747677-admin.sharepoint.com
2025-09-04 10:30:58 [Error] Failed to connect to SharePoint Online: Specified method is not supported.
2025-09-04 10:30:58 [Warning] Will continue with limited SharePoint functionality...
2025-09-04 10:30:58 [Info] Connecting to Exchange Online...
2025-09-04 10:30:59 [Warning] Warning: Could not connect to Exchange Online. Continuing with limited functionality...
2025-09-04 10:30:59 [Warning] Exchange Online error: Unable to load DLL 'msalruntime' or one of its dependencies: The specified module could not be found. (0x8007007E) See https://aka.ms/msal-net-wam#troubleshooting
2025-09-04 10:30:59 [Success] ‚úÖ Service connection process complete
2025-09-04 10:30:59 [Info] Step 2/7: Discovering external users...
2025-09-04 10:30:59 [Info] üîç Discovering external users in tenant...
2025-09-04 10:30:59 [Info] Attempting to retrieve guest users from Azure AD...
2025-09-04 10:30:59 [Warning] Primary Graph query failed: Could not load type 'Microsoft.Graph.Authentication.AzureIdentityAccessTokenProvider' from assembly 'Microsoft.Graph.Core, Version=1.25.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35'.
2025-09-04 10:30:59 [Info] Attempting alternative approach...
2025-09-04 10:30:59 [Error] Alternative Graph query also failed: Could not load type 'Microsoft.Graph.Authentication.AzureIdentityAccessTokenProvider' from assembly 'Microsoft.Graph.Core, Version=1.25.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35'.
2025-09-04 10:30:59 [Info] Found 0 guest users in Azure AD
2025-09-04 10:30:59 [Warning] SharePoint PnP module not available, skipping SharePoint external user discovery
2025-09-04 10:30:59 [Success] Total external users discovered: 0
2025-09-04 10:30:59 [Warning] No external users found. This could indicate:
2025-09-04 10:30:59 [Warning]   1. No external users exist in the tenant
2025-09-04 10:30:59 [Warning]   2. Insufficient permissions to view external users
2025-09-04 10:30:59 [Warning]   3. Module or authentication issues
2025-09-04 10:30:59 [Warning] No external users found in the tenant
2025-09-04 14:38:26 [Info] Starting Microsoft 365 External User Audit...
2025-09-04 14:38:26 [Info] Output Path: .\AuditReports
2025-09-04 14:38:26 [Info] Step 0/7: Checking module requirements...
2025-09-04 14:39:24 [Info] Step 1/7: Authenticating to Microsoft 365...
2025-09-04 14:39:24 [Info] üîê Initiating Microsoft 365 authentication sequence...
2025-09-04 14:39:24 [Info] Connecting to Microsoft Graph...
2025-09-04 14:39:24 [Error] Failed to connect to Microsoft Graph: A parameter cannot be found that matches parameter name 'ForceRefresh'.
2025-09-04 14:39:24 [Info] Attempting alternative Graph connection method...
2025-09-04 14:41:24 [Success] ‚úÖ Connected to Microsoft Graph with basic scopes
2025-09-04 14:41:24 [Info] Connecting to SharePoint Online...
2025-09-04 14:41:24 [Info] Using SharePoint Admin URL: https://m365x22747677-admin.sharepoint.com
2025-09-04 14:41:25 [Error] Failed to connect to SharePoint Online: Specified method is not supported.
2025-09-04 14:41:25 [Warning] Script will continue with limited SharePoint functionality
2025-09-04 14:41:25 [Info] Connecting to Exchange Online...
2025-09-04 14:41:25 [Warning] Warning: Could not connect to Exchange Online with user authentication. Trying interactive...
2025-09-04 14:41:25 [Warning] Warning: Could not connect to Exchange Online. Continuing with limited functionality...
2025-09-04 14:41:25 [Warning] Exchange Online error: Unable to load DLL 'msalruntime' or one of its dependencies: The specified module could not be found. (0x8007007E) See https://aka.ms/msal-net-wam#troubleshooting
2025-09-04 14:41:25 [Warning] Note: Group membership analysis may be limited without Exchange Online access
2025-09-04 14:41:25 [Success] ‚úÖ Authentication sequence completed
2025-09-04 14:41:25 [Info] Step 2/7: Discovering external users...
2025-09-04 14:41:25 [Info] üîç Discovering external users in tenant...
2025-09-04 14:41:25 [Info] Querying Azure AD for guest users...
2025-09-04 14:41:25 [Warning] Error querying Azure AD for guest users: Could not load type 'Microsoft.Graph.Authentication.AzureIdentityAccessTokenProvider' from assembly 'Microsoft.Graph.Core, Version=1.25.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35'.
2025-09-04 14:41:25 [Info] Continuing with SharePoint-only discovery...
2025-09-04 14:41:25 [Info] Querying SharePoint for external users...
2025-09-04 14:41:25 [Warning] Error querying SharePoint for external users: You are not signed in. Please use Connect-PnPOnline to connect.
2025-09-04 14:41:25 [Warning] SharePoint external user discovery skipped
2025-09-04 14:41:25 [Success] Total external users discovered: 0
2025-09-04 14:41:25 [Warning] No external users found. This could indicate:
2025-09-04 14:41:25 [Warning] 1. No external users exist in the tenant
2025-09-04 14:41:25 [Warning] 2. Insufficient permissions to query external users
2025-09-04 14:41:25 [Warning] 3. Connection issues with Microsoft Graph or SharePoint
2025-09-04 14:41:25 [Warning] No external users found in the tenant
2025-09-04 14:45:44 [Info] Starting Microsoft 365 External User Audit...
2025-09-04 14:45:44 [Info] Output Path: .\AuditReports
2025-09-04 14:45:44 [Info] Step 0/7: Checking module requirements...
2025-09-04 14:45:44 [Info] Step 1/7: Authenticating to Microsoft 365...
2025-09-04 14:45:44 [Info] üîê Initiating Microsoft 365 authentication sequence...
2025-09-04 14:45:45 [Info] Connecting to Microsoft Graph...
2025-09-04 14:45:45 [Error] Failed to connect to Microsoft Graph: A parameter cannot be found that matches parameter name 'ForceRefresh'.
2025-09-04 14:45:45 [Info] Attempting alternative Graph connection method...
2025-09-04 14:45:48 [Success] ‚úÖ Connected to Microsoft Graph with basic scopes
2025-09-04 14:45:48 [Info] Connecting to SharePoint Online...
2025-09-04 14:45:48 [Info] Using SharePoint Admin URL: https://m365x22747677-admin.sharepoint.com
2025-09-04 14:45:51 [Success] ‚úÖ Connected to SharePoint Online: https://m365x22747677-admin.sharepoint.com
2025-09-04 14:45:51 [Info] Connecting to Exchange Online...
2025-09-04 14:45:51 [Warning] Warning: Could not connect to Exchange Online with user authentication. Trying interactive...
2025-09-04 14:45:51 [Warning] Warning: Could not connect to Exchange Online. Continuing with limited functionality...
2025-09-04 14:45:51 [Warning] Exchange Online error: Unable to load DLL 'msalruntime' or one of its dependencies: The specified module could not be found. (0x8007007E) See https://aka.ms/msal-net-wam#troubleshooting
2025-09-04 14:45:51 [Warning] Note: Group membership analysis may be limited without Exchange Online access
2025-09-04 14:45:51 [Success] ‚úÖ Authentication sequence completed
2025-09-04 14:45:52 [Info] Step 2/7: Discovering external users...
2025-09-04 14:45:52 [Info] üîç Discovering external users in tenant...
2025-09-04 14:45:52 [Info] Querying Azure AD for guest users...
2025-09-04 14:45:52 [Warning] Error querying Azure AD for guest users: Could not load type 'Microsoft.Graph.Authentication.AzureIdentityAccessTokenProvider' from assembly 'Microsoft.Graph.Core, Version=1.25.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35'.
2025-09-04 14:45:52 [Info] Continuing with SharePoint-only discovery...
2025-09-04 14:45:52 [Info] Querying SharePoint for external users...
2025-09-04 14:45:53 [Info] Found 1 additional external users in SharePoint
2025-09-04 14:45:53 [Success] Total external users discovered: 1
2025-09-04 14:45:53 [Info] Step 3/7: Analyzing SharePoint site access...
2025-09-04 14:45:53 [Info] üìÇ Analyzing SharePoint site access...
2025-09-04 14:45:54 [Warning] Error processing site: https://m365x22747677-my.sharepoint.com/
2025-09-04 14:45:54 [Warning] Error processing site: https://m365x22747677.sharepoint.com/
2025-09-04 14:45:55 [Warning] Error processing site: https://m365x22747677.sharepoint.com/search
2025-09-04 14:45:55 [Warning] Error processing site: https://m365x22747677.sharepoint.com/sites/allcompany
2025-09-04 14:45:55 [Warning] Error processing site: https://m365x22747677.sharepoint.com/sites/AllUsersGroupsOfTenant
2025-09-04 14:45:56 [Warning] Error processing site: https://m365x22747677.sharepoint.com/sites/benefits
2025-09-04 14:45:56 [Warning] Error processing site: https://m365x22747677.sharepoint.com/sites/ContosoBrand
2025-09-04 14:45:56 [Warning] Error processing site: https://m365x22747677.sharepoint.com/sites/ContosoNews
2025-09-04 14:45:56 [Warning] Error processing site: https://m365x22747677.sharepoint.com/sites/contosoteam
2025-09-04 14:45:57 [Warning] Error processing site: https://m365x22747677.sharepoint.com/sites/ContosoWorks
2025-09-04 14:45:57 [Warning] Error processing site: https://m365x22747677.sharepoint.com/sites/DigitalInitiativePublicRelations
2025-09-04 14:45:57 [Warning] Error processing site: https://m365x22747677.sharepoint.com/sites/droneproducttraining
2025-09-04 14:45:57 [Warning] Error processing site: https://m365x22747677.sharepoint.com/sites/FlySafeConference
2025-09-04 14:45:58 [Warning] Error processing site: https://m365x22747677.sharepoint.com/sites/give
2025-09-04 14:45:58 [Warning] Error processing site: https://m365x22747677.sharepoint.com/sites/GlobalMarketing
2025-09-04 14:45:58 [Warning] Error processing site: https://m365x22747677.sharepoint.com/sites/GlobalSales
2025-09-04 14:45:58 [Warning] Error processing site: https://m365x22747677.sharepoint.com/sites/Leadership
2025-09-04 14:45:59 [Warning] Error processing site: https://m365x22747677.sharepoint.com/sites/leadership-connection
2025-09-04 14:45:59 [Warning] Error processing site: https://m365x22747677.sharepoint.com/sites/Mark8ProjectTeam
2025-09-04 14:45:59 [Warning] Error processing site: https://m365x22747677.sharepoint.com/sites/RecordsManagementAdmins
2025-09-04 14:45:59 [Warning] Error processing site: https://m365x22747677.sharepoint.com/sites/Retail
2025-09-04 14:46:00 [Warning] Error processing site: https://m365x22747677.sharepoint.com/sites/RetailOperations
2025-09-04 14:46:00 [Warning] Error processing site: https://m365x22747677.sharepoint.com/sites/SalesAndMarketing
2025-09-04 14:46:00 [Warning] Error processing site: https://m365x22747677.sharepoint.com/sites/SalesPlanning
2025-09-04 14:46:00 [Warning] Error processing site: https://m365x22747677.sharepoint.com/sites/SOCTeam
2025-09-04 14:46:01 [Warning] Error processing site: https://m365x22747677.sharepoint.com/sites/ThePerspective
2025-09-04 14:46:01 [Warning] Error processing site: https://m365x22747677.sharepoint.com/sites/userid
2025-09-04 14:46:01 [Warning] Error processing site: https://m365x22747677.sharepoint.com/sites/USSales
2025-09-04 14:46:01 [Success] ‚úÖ SharePoint site analysis complete
2025-09-04 14:46:01 [Info] Step 4/7: Analyzing Microsoft Teams access...
2025-09-04 14:46:01 [Info] üë• Analyzing Microsoft Teams access...
2025-09-04 14:46:01 [Success] ‚úÖ Teams analysis complete
2025-09-04 14:46:01 [Info] Step 5/7: Analyzing Microsoft 365 Group memberships...
2025-09-04 14:46:01 [Info] üìä Analyzing Microsoft 365 Group memberships...
2025-09-04 14:46:01 [Success] ‚úÖ Microsoft 365 Groups analysis complete
2025-09-04 14:46:02 [Info] Step 6/7: Analyzing site sharing settings...
2025-09-04 14:46:02 [Info] üîó Analyzing site sharing settings...
2025-09-04 14:46:02 [Success] ‚úÖ Site sharing settings analysis complete
2025-09-04 14:46:02 [Info] Step 7/7: Analyzing guest expiration...
2025-09-04 14:46:02 [Info] ‚è∞ Analyzing guest expiration settings...
2025-09-04 14:46:02 [Success] ‚úÖ Guest expiration analysis complete
2025-09-04 14:46:02 [Info] üìÑ Generating audit reports...
2025-09-04 14:46:02 [Success] ‚úÖ Main report exported: .\AuditReports\ExternalUserAudit_Main_20250904_144602.csv
2025-09-04 14:46:03 [Success] ‚úÖ Sharing settings report exported: .\AuditReports\SiteSharingSettings_20250904_144602.csv
2025-09-04 14:46:03 [Success] ‚úÖ Guest expiration report exported: .\AuditReports\GuestExpiration_20250904_144602.csv
2025-09-04 14:46:03 [Success] ‚úÖ Executive summary generated: .\AuditReports\ExecutiveSummary_20250904_144602.md
2025-09-04 14:46:03 [Success] ‚úÖ All reports generated successfully
2025-09-04 14:46:03 [Info] Disconnecting from Microsoft 365 services...
